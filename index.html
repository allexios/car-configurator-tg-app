<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Конфигуратор автомобиля</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-button-color: #50a8eb;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f0f0f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            padding: 16px;
            line-height: 1.5;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        .step {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .step.active {
            display: block;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        h2 {
            margin: 20px 0 15px 0;
            font-size: 1.2rem;
        }

        .model-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .model-card:hover {
            border-color: var(--tg-theme-button-color);
        }

        .model-card.selected {
            border-color: var(--tg-theme-button-color);
            background: rgba(80, 168, 235, 0.1);
        }

        .model-name {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .model-price {
            color: #666;
            margin-top: 5px;
        }

        .color-option {
            display: inline-block;
            width: 60px;
            height: 60px;
            border-radius: 8px;
            margin: 5px;
            cursor: pointer;
            border: 3px solid transparent;
            position: relative;
        }

        .color-option.selected {
            border-color: var(--tg-theme-button-color);
        }

        .color-option.selected::after {
            content: "✓";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .option-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .option-item.selected {
            border-color: var(--tg-theme-button-color);
            background: rgba(80, 168, 235, 0.1);
        }

        .option-price {
            color: #28a745;
            font-weight: bold;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .total-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--tg-theme-button-color);
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: var(--tg-theme-secondary-bg-color);
            border-radius: 10px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
        }

        .btn-secondary {
            background: var(--tg-theme-secondary-bg-color);
            color: var(--tg-theme-text-color);
        }

        .navigation {
            position: sticky;
            bottom: 0;
            background: var(--tg-theme-bg-color);
            padding: 15px 0;
            border-top: 1px solid #eee;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .car-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            margin: 10px auto;
            display: block;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Шаг 1: Выбор модели -->
        <div class="step active" id="step-model">
            <h1>Выберите модель автомобиля</h1>
            
            <div class="model-card" data-model="sedan" data-price="1500000">
                <div class="model-name">Седан Comfort</div>
                <div class="model-price">от 1 500 000 ₽</div>
                <ul>
                    <li>1.6 л двигатель</li>
                    <li>АКПП</li>
                    <li>Кондиционер</li>
                </ul>
            </div>

            <div class="model-card" data-model="suv" data-price="1800000">
                <div class="model-name">Внедорожник Premium</div>
                <div class="model-price">от 1 800 000 ₽</div>
                <ul>
                    <li>2.0 л двигатель</li>
                    <li>Полный привод</li>
                    <li>Климат-контроль</li>
                </ul>
            </div>

            <div class="model-card" data-model="coupe" data-price="2200000">
                <div class="model-name">Купе Sport</div>
                <div class="model-price">от 2 200 000 ₽</div>
                <ul>
                    <li>2.5 л двигатель</li>
                    <li>Спортивная подвеска</li>
                    <li>Кожаный салон</li>
                </ul>
            </div>
        </div>

        <!-- Шаг 2: Выбор цвета -->
        <div class="step" id="step-color">
            <h1>Выберите цвет</h1>
            
            <div style="text-align: center;">
                <div class="color-option" data-color="white" data-price="0" style="background: #ffffff; border: 1px solid #ccc;"></div>
                <div class="color-option" data-color="black" data-price="0" style="background: #000000;"></div>
                <div class="color-option" data-color="silver" data-price="0" style="background: #c0c0c0;"></div>
                <div class="color-option" data-color="red" data-price="15000" style="background: #ff0000;"></div>
                <div class="color-option" data-color="blue" data-price="15000" style="background: #0000ff;"></div>
                <div class="color-option" data-color="green" data-price="20000" style="background: #008000;"></div>
            </div>

            <div id="color-image">
                <!-- Здесь будет изображение автомобиля выбранного цвета -->
            </div>
        </div>

        <!-- Шаг 3: Дополнительные опции -->
        <div class="step" id="step-options">
            <h1>Дополнительные опции</h1>
            
            <div class="option-item" data-option="leather" data-price="50000">
                <span>Кожаный салон</span>
                <span class="option-price">+50 000 ₽</span>
            </div>

            <div class="option-item" data-option="premium-sound" data-price="30000">
                <span>Премиальная аудиосистема</span>
                <span class="option-price">+30 000 ₽</span>
            </div>

            <div class="option-item" data-option="panorama" data-price="70000">
                <span>Панорамная крыша</span>
                <span class="option-price">+70 000 ₽</span>
            </div>

            <div class="option-item" data-option="assist" data-price="40000">
                <span>Система помощи при парковке</span>
                <span class="option-price">+40 000 ₽</span>
            </div>

            <div class="option-item" data-option="winter" data-price="25000">
                <span>Зимний пакет (подогревы)</span>
                <span class="option-price">+25 000 ₽</span>
            </div>
        </div>

        <!-- Шаг 4: Итоговая конфигурация -->
        <div class="step" id="step-summary">
            <h1>Ваша конфигурация</h1>
            
            <div id="summary-content">
                <!-- Сюда подставляется итоговая информация -->
            </div>

            <div class="total-price" id="total-price">
                Итого: 0 ₽
            </div>

            <button class="btn-primary" onclick="sendToManager()">Отправить менеджеру</button>
        </div>

        <!-- Навигация -->
        <div class="navigation">
            <div class="button-group">
                <button class="btn-secondary" id="btn-prev" onclick="prevStep()" disabled>Назад</button>
                <button class="btn-primary" id="btn-next" onclick="nextStep()">Далее</button>
            </div>
        </div>
    </div>

    <script>
        // Текущее состояние конфигурации
        const configuration = {
            model: null,
            color: null,
            options: [],
            basePrice: 0,
            totalPrice: 0
        };

        const steps = ['step-model', 'step-color', 'step-options', 'step-summary'];
        let currentStep = 0;

        // Инициализация Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.BackButton.hide();

        // Навигация по шагам
        function showStep(stepIndex) {
            steps.forEach((step, index) => {
                const element = document.getElementById(step);
                if (index === stepIndex) {
                    element.classList.add('active');
                } else {
                    element.classList.remove('active');
                }
            });

            // Обновляем кнопки навигации
            document.getElementById('btn-prev').disabled = stepIndex === 0;
            document.getElementById('btn-next').textContent = stepIndex === steps.length - 1 ? 'Завершить' : 'Далее';

            // На последнем шаге обновляем итоги
            if (stepIndex === steps.length - 1) {
                updateSummary();
            }
        }

        function nextStep() {
            if (currentStep < steps.length - 1) {
                currentStep++;
                showStep(currentStep);
            } else {
                // Действие при завершении
                tg.showPopup({
                    title: 'Готово!',
                    message: 'Конфигурация сохранена. Нажмите "Отправить менеджеру" для связи.',
                    buttons: [{ type: 'ok' }]
                });
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                showStep(currentStep);
            }
        }

        // Выбор модели
        document.querySelectorAll('.model-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.model-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                
                configuration.model = this.dataset.model;
                configuration.basePrice = parseInt(this.dataset.price);
                calculateTotal();
            });
        });

        // Выбор цвета
        document.querySelectorAll('.color-option').forEach(color => {
            color.addEventListener('click', function() {
                document.querySelectorAll('.color-option').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                
                configuration.color = this.dataset.color;
                calculateTotal();
                
                // Можно добавить смену изображения автомобиля
                updateColorImage();
            });
        });

        // Выбор опций
        document.querySelectorAll('.option-item').forEach(option => {
            option.addEventListener('click', function() {
                this.classList.toggle('selected');
                
                const optionId = this.dataset.option;
                const optionPrice = parseInt(this.dataset.price);
                
                if (this.classList.contains('selected')) {
                    if (!configuration.options.includes(optionId)) {
                        configuration.options.push(optionId);
                    }
                } else {
                    configuration.options = configuration.options.filter(opt => opt !== optionId);
                }
                
                calculateTotal();
            });
        });

        // Расчет общей стоимости
        function calculateTotal() {
            let total = configuration.basePrice;
            
            // Добавляем стоимость цвета
            const selectedColor = document.querySelector('.color-option.selected');
            if (selectedColor) {
                total += parseInt(selectedColor.dataset.price);
            }
            
            // Добавляем стоимость опций
            document.querySelectorAll('.option-item.selected').forEach(option => {
                total += parseInt(option.dataset.price);
            });
            
            configuration.totalPrice = total;
            
            // Обновляем отображение цены если на последнем шаге
            if (currentStep === steps.length - 1) {
                updateSummary();
            }
        }

        // Обновление итоговой страницы
        function updateSummary() {
            const summaryContent = document.getElementById('summary-content');
            const totalPriceElement = document.getElementById('total-price');
            
            let html = `
                <div class="summary-item">
                    <span>Модель:</span>
                    <span>${getModelName(configuration.model)}</span>
                </div>
                <div class="summary-item">
                    <span>Базовая цена:</span>
                    <span>${formatPrice(configuration.basePrice)} ₽</span>
                </div>
            `;
            
            if (configuration.color) {
                const colorPrice = document.querySelector('.color-option.selected').dataset.price;
                html += `
                    <div class="summary-item">
                        <span>Цвет (${configuration.color}):</span>
                        <span>+${formatPrice(parseInt(colorPrice))} ₽</span>
                    </div>
                `;
            }
            
            if (configuration.options.length > 0) {
                html += `<div class="summary-item"><strong>Доп. опции:</strong></div>`;
                configuration.options.forEach(option => {
                    const optionElement = document.querySelector(`[data-option="${option}"]`);
                    const optionPrice = optionElement.dataset.price;
                    html += `
                        <div class="summary-item">
                            <span>• ${optionElement.querySelector('span').textContent}</span>
                            <span>+${formatPrice(parseInt(optionPrice))} ₽</span>
                        </div>
                    `;
                });
            }
            
            summaryContent.innerHTML = html;
            totalPriceElement.textContent = `Итого: ${formatPrice(configuration.totalPrice)} ₽`;
        }

        // Вспомогательные функции
        function getModelName(model) {
            const models = {
                'sedan': 'Седан Comfort',
                'suv': 'Внедорожник Premium',
                'coupe': 'Купе Sport'
            };
            return models[model] || 'Не выбрано';
        }

        function formatPrice(price) {
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        }

        function updateColorImage() {
            // Здесь можно добавить логику смены изображения автомобиля
            // В зависимости от выбранного цвета
        }

        // Отправка конфигурации менеджеру
        function sendToManager() {
            const configData = {
                model: configuration.model,
                color: configuration.color,
                options: configuration.options,
                totalPrice: configuration.totalPrice
            };
            
            // Отправляем данные боту
            tg.sendData(JSON.stringify(configData));
            
            tg.showPopup({
                title: 'Отправлено!',
                message: 'Ваша конфигурация отправлена менеджеру. Мы свяжемся с вами в ближайшее время.',
                buttons: [{ type: 'ok' }]
            });
        }

        // Инициализация
        showStep(0);
    </script>
</body>
</html>
